<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Asistencia – Orquestando 2026</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background: url("fondo-orquestando.jpg") no-repeat center center fixed;
  background-size: cover;
}

.container{
  background: rgba(255,255,255,0.95);
  max-width:1200px;
  margin:30px auto;
  padding:25px;
  border-radius:20px;
}

header{
  text-align:center;
}

header img{
  max-width:220px;
}

h2,h3{ color:#5a4bcf; }

select, input[type="date"]{
  padding:8px;
  margin:5px;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
}

th, td{
  border:1px solid #ccc;
  padding:8px;
  text-align:center;
}

th{
  background:#5a4bcf;
  color:white;
}

/* COLORES ASISTENCIA */
.A { background:#2ecc71; color:white; font-weight:bold; }
.T { background:#f39c12; color:white; font-weight:bold; }
.J { background:#3498db; color:white; font-weight:bold; }
.F { background:#e74c3c; color:white; font-weight:bold; }

button{
  padding:10px 20px;
  margin:5px;
  background:#5a4bcf;
  color:white;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="container">

<header>
  <img src="logo-orquestando.png">
  <h2>Asistencia – Orquestando 2026</h2>
</header>

<hr>

<label>Educador:</label>
<select id="educador"></select>

<label>Grupo:</label>
<select id="grupo"></select>

<label>Fecha:</label>
<input type="date" id="fecha">

<table>
<thead>
<tr>
  <th>Alumno</th>
  <th>Asistencia</th>
</tr>
</thead>
<tbody id="tabla"></tbody>
</table>

<br>

<button onclick="guardarAsistencia()">Guardar asistencia</button>
<button onclick="verReporteMensual()">Ver reporte mensual</button>
<button onclick="descargarReporte()">Descargar informe mensual</button>

<div id="reporte"></div>

</div>

<script>
const CSV_URL = "https://raw.githubusercontent.com/elvisade/Asistencia-ni-os-vacacional-2026/main/ninos.csv";

let estructura = {};   // educador -> grupo -> alumnos
let asistencias = [];  // registros

/* ======================
   CARGA CSV
====================== */
fetch(CSV_URL)
.then(r=>r.text())
.then(text=>{
  const lines = text.trim().split("\n");
  const headers = lines[0].toLowerCase().split(",");

  const iEdu = headers.findIndex(h=>h.includes("educador"));
  const iGrupo = headers.findIndex(h=>h.includes("grupo"));
  const iNom = headers.findIndex(h=>h.includes("nombre"));
  const iApe = headers.findIndex(h=>h.includes("apellido"));

  for(let i=1;i<lines.length;i++){
    const c = lines[i].split(",");
    const edu = c[iEdu].trim();
    const grupo = c[iGrupo].trim();
    const alumno = `${c[iNom].trim()} ${c[iApe].trim()}`;

    if(!estructura[edu]) estructura[edu]={};
    if(!estructura[edu][grupo]) estructura[edu][grupo]=[];
    estructura[edu][grupo].push(alumno);
  }

  educador.innerHTML =
    `<option value="">Seleccione</option>` +
    Object.keys(estructura).map(e=>`<option>${e}</option>`).join("");
});

/* ======================
   CAMBIO EDUCADOR
====================== */
educador.onchange = () => {
  grupo.innerHTML = `<option value="">Seleccione</option>`;
  tabla.innerHTML = "";
  const g = estructura[educador.value];
  if(!g) return;

  grupo.innerHTML += Object.keys(g).map(gr=>`<option>${gr}</option>`).join("");
};

grupo.onchange = cargarTabla;

/* ======================
   TABLA MARCADO
====================== */
function cargarTabla(){
  tabla.innerHTML = "";
  const alumnos = estructura[educador.value][grupo.value];

  alumnos.forEach((a,i)=>{
    tabla.innerHTML += `
    <tr>
      <td>${a}</td>
      <td>
        <select id="a${i}" onchange="this.className=this.value">
          <option value="">-</option>
          <option value="A" class="A">A</option>
          <option value="T" class="T">T</option>
          <option value="J" class="J">J</option>
          <option value="F" class="F">F</option>
        </select>
      </td>
    </tr>`;
  });
}

/* ======================
   GUARDAR
====================== */
function guardarAsistencia(){
  if(!fecha.value){ alert("Seleccione fecha"); return; }

  const alumnos = estructura[educador.value][grupo.value];
  alumnos.forEach((a,i)=>{
    const estado = document.getElementById(`a${i}`).value;
    if(estado){
      asistencias.push({
        fecha: fecha.value,
        educador: educador.value,
        grupo: grupo.value,
        alumno: a,
        estado
      });
    }
  });

  alert("✔ Asistencia guardada");
}

/* ======================
   REPORTE RESUMIDO
====================== */
function verReporteMensual(){
  const mes = prompt("Mes/Año (MM/YYYY)", "01/2026");
  if(!mes) return;

  const [m,y] = mes.split("/").map(Number);
  const resumen = {};

  asistencias.forEach(r=>{
    const d = new Date(r.fecha);
    if(d.getMonth()+1===m && d.getFullYear()===y){
      const key = r.alumno + r.grupo;
      if(!resumen[key]){
        resumen[key] = { alumno:r.alumno, grupo:r.grupo, A:0,T:0,J:0,F:0 };
      }
      resumen[key][r.estado]++;
    }
  });

  let html = `<h3>Reporte mensual ${mes}</h3>
  <table>
  <tr>
    <th>Alumno</th>
    <th>Grupo</th>
    <th class="A">A</th>
    <th class="T">T</th>
    <th class="J">J</th>
    <th class="F">F</th>
  </tr>`;

  Object.values(resumen).forEach(r=>{
    html += `
    <tr>
      <td>${r.alumno}</td>
      <td>${r.grupo}</td>
      <td class="A">${r.A}</td>
      <td class="T">${r.T}</td>
      <td class="J">${r.J}</td>
      <td class="F">${r.F}</td>
    </tr>`;
  });

  html += "</table>";
  document.getElementById("reporte").innerHTML = html;
}

/* ======================
   DESCARGAR CSV
====================== */
function descargarReporte(){
  let csv = "Alumno,Grupo,A,T,J,F\n";
  document.querySelectorAll("#reporte table tr").forEach((tr,i)=>{
    if(i>0){
      csv += [...tr.children].map(td=>td.innerText).join(",")+"\n";
    }
  });

  const blob = new Blob([csv],{type:"text/csv"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "reporte_mensual_orquestando.csv";
  a.click();
}
</script>

</body>
</html>
