<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Asistencia Orquestando 2026</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f2f2f2;
  margin: 20px;
}

h1 {
  text-align: center;
}

.controls {
  margin-bottom: 20px;
}

table {
  width: 100%;
  border-collapse: collapse;
  background: #fff;
}

th, td {
  border: 1px solid #ccc;
  padding: 6px;
  text-align: center;
}

select {
  width: 60px;
  font-size: 14px;
}

button {
  margin-top: 15px;
  padding: 10px 20px;
  font-size: 16px;
}
</style>
</head>

<body>

<h1>Asistencia Niños – Orquestando 2026</h1>

<div class="controls">
  <label>Educador:</label>
  <select id="educador">
    <option value="">Seleccione</option>
    <option value="Educador 1">Educador 1</option>
    <option value="Educador 2">Educador 2</option>
    <option value="Educador 3">Educador 3</option>
  </select>

  <label>Fecha:</label>
  <input type="date" id="fecha">
</div>

<table>
  <thead>
    <tr>
      <th>Alumno</th>
      <th>Asistencia</th>
    </tr>
  </thead>
  <tbody id="tabla"></tbody>
</table>

<button onclick="guardarAsistencia()">Guardar Asistencia</button>

<script type="module">
import { db } from "./firebase.js";
import {
  collection,
  addDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const CSV_URL = "https://raw.githubusercontent.com/elvisade/Asistencia-ni-os-vacacional-2026/main/ninos.csv";
let ninos = [];

// Cargar niños
fetch(CSV_URL)
  .then(res => res.text())
  .then(data => {
    const filas = data.trim().split("\n");
    filas.shift();

    filas.forEach(fila => {
      const [dni, nombre] = fila.split(",");
      ninos.push({ dni, nombre });
    });

    renderTabla();
  });

function renderTabla() {
  const tbody = document.getElementById("tabla");
  tbody.innerHTML = "";

  ninos.forEach(n => {
    tbody.innerHTML += `
      <tr>
        <td>${n.nombre}</td>
        <td>
          <select data-dni="${n.dni}" data-nombre="${n.nombre}">
            <option value="">-</option>
            <option value="A">A</option>
            <option value="T">T</option>
            <option value="J">J</option>
            <option value="F">F</option>
          </select>
        </td>
      </tr>
    `;
  });
}

window.guardarAsistencia = async () => {
  const educador = document.getElementById("educador").value;
  const fecha = document.getElementById("fecha").value;

  if (!educador || !fecha) {
    alert("Seleccione educador y fecha");
    return;
  }

  const selects = document.querySelectorAll("select[data-dni]");

  for (let s of selects) {
    if (s.value !== "") {
      await addDoc(collection(db, "asistencias"), {
        dni: s.dataset.dni,
        nombre: s.dataset.nombre,
        fecha,
        estado: s.value,
        educador
      });
    }
  }

  alert("Asistencia guardada correctamente ✔");
};
</script>

</body>
</html>
