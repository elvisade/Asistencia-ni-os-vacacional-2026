<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Asistencia – Orquestando 2026</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background: url("fondo-orquestando.jpg") no-repeat center center fixed;
  background-size: cover;
}

.container{
  background: rgba(255,255,255,0.95);
  max-width:1200px;
  margin:30px auto;
  padding:25px;
  border-radius:20px;
}

header{
  text-align:center;
}

header img{
  max-width:220px;
}

h2{ color:#5a4bcf; }

select, input[type="date"]{
  padding:8px;
  margin:5px;
}

table{
  width:100%;
  border-collapse:collapse;
  margin-top:20px;
}

th, td{
  border:1px solid #ccc;
  padding:8px;
  text-align:center;
}

th{
  background:#5a4bcf;
  color:white;
}

button{
  padding:10px 20px;
  margin:5px;
  background:#5a4bcf;
  color:white;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
</style>
</head>

<body>
<div class="container">

<header>
  <img src="logo-orquestando.png">
  <h2>Asistencia – Orquestando 2026</h2>
</header>

<hr>

<label>Educador:</label>
<select id="educador"></select>

<label>Grupo:</label>
<select id="grupo"></select>

<label>Fecha:</label>
<input type="date" id="fecha">

<table>
<thead>
<tr>
  <th>Alumno</th>
  <th>Asistencia</th>
</tr>
</thead>
<tbody id="tabla"></tbody>
</table>

<br>

<button onclick="guardarAsistencia()">Guardar asistencia</button>
<button onclick="verReporteMensual()">Ver reporte mensual</button>
<button onclick="descargarReporte()">Descargar informe mensual</button>

<div id="reporte"></div>

</div>

<script>
const CSV_URL = "https://raw.githubusercontent.com/elvisade/Asistencia-ni-os-vacacional-2026/main/ninos.csv";

let estructura = {};   // educador -> grupo -> alumnos
let asistencias = [];  // registros guardados

/* =======================
   CARGA CSV
======================= */
fetch(CSV_URL)
.then(r=>r.text())
.then(text=>{
  const lines = text.trim().split("\n");
  const headers = lines[0].toLowerCase().split(",");

  const iEdu = headers.findIndex(h=>h.includes("educador"));
  const iGrupo = headers.findIndex(h=>h.includes("grupo"));
  const iNom = headers.findIndex(h=>h.includes("nombre"));
  const iApe = headers.findIndex(h=>h.includes("apellido"));

  for(let i=1;i<lines.length;i++){
    const c = lines[i].split(",");
    const edu = c[iEdu].trim();
    const grupo = c[iGrupo].trim();
    const alumno = `${c[iNom].trim()} ${c[iApe].trim()}`;

    if(!estructura[edu]) estructura[edu]={};
    if(!estructura[edu][grupo]) estructura[edu][grupo]=[];
    estructura[edu][grupo].push(alumno);
  }

  educador.innerHTML = `<option value="">Seleccione</option>` +
    Object.keys(estructura).map(e=>`<option>${e}</option>`).join("");
});

/* =======================
   EVENTOS
======================= */
educador.onchange = () => {
  grupo.innerHTML = `<option value="">Seleccione</option>`;
  tabla.innerHTML = "";
  const g = estructura[educador.value];
  if(!g) return;

  grupo.innerHTML += Object.keys(g).map(gr=>`<option>${gr}</option>`).join("");
};

grupo.onchange = cargarTabla;

/* =======================
   TABLA ASISTENCIA
======================= */
function cargarTabla(){
  tabla.innerHTML = "";
  const alumnos = estructura[educador.value][grupo.value];
  alumnos.forEach((a,i)=>{
    tabla.innerHTML += `
      <tr>
        <td>${a}</td>
        <td>
          <select id="a${i}">
            <option value="">-</option>
            <option>A</option>
            <option>T</option>
            <option>J</option>
            <option>F</option>
          </select>
        </td>
      </tr>`;
  });
}

/* =======================
   GUARDAR ASISTENCIA
======================= */
function guardarAsistencia(){
  if(!fecha.value){ alert("Seleccione fecha"); return; }

  const alumnos = estructura[educador.value][grupo.value];
  alumnos.forEach((a,i)=>{
    const val = document.getElementById(`a${i}`).value;
    if(val){
      asistencias.push({
        fecha: fecha.value,
        educador: educador.value,
        grupo: grupo.value,
        alumno: a,
        estado: val
      });
    }
  });

  alert("✔ Asistencia guardada");
}

/* =======================
   REPORTE VISUAL
======================= */
function verReporteMensual(){
  const mes = prompt("Mes/Año (MM/YYYY)", "01/2026");
  if(!mes) return;

  const [m,y]=mes.split("/").map(Number);
  const filtrado = asistencias.filter(r=>{
    const d=new Date(r.fecha);
    return d.getMonth()+1===m && d.getFullYear()===y;
  });

  let html = `<h3>Reporte ${mes}</h3><table><tr>
    <th>Fecha</th><th>Grupo</th><th>Alumno</th><th>Estado</th></tr>`;

  filtrado.forEach(r=>{
    html+=`<tr>
      <td>${r.fecha}</td>
      <td>${r.grupo}</td>
      <td>${r.alumno}</td>
      <td>${r.estado}</td>
    </tr>`;
  });

  html+="</table>";
  reporte.innerHTML = html;
}

/* =======================
   DESCARGAR CSV
======================= */
function descargarReporte(){
  let csv = "Fecha,Educador,Grupo,Alumno,Estado\n";
  asistencias.forEach(r=>{
    csv+=`${r.fecha},${r.educador},${r.grupo},${r.alumno},${r.estado}\n`;
  });

  const blob = new Blob([csv],{type:"text/csv"});
  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "asistencia_orquestando_2026.csv";
  a.click();
}
</script>

</body>
</html>
